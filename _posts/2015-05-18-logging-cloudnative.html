---
layout: blog
subtitle: "Logging for Cloud Native Apps"
permalink: /blog/logging-cloudnative.html
---
<div>
    <p>When it comes to building and running applications that are native to the cloud a number of old habits need to die
        and make way for modern alternatives. One of these is traditional file-based logging.</p>

    <p><strong>The days of using <em>tail -f</em> to watch logs scroll by in 5 different terminals are over.</strong></p>

    <p>This becomes even clearer as you move away from traditional operating systems and classic provisioning towards
        modern <strong>secure minimal images</strong> like those <a href="/blog/welcome">generated by Boxfuse</a>. These machines are tailor-made
        for running your application and don't contain any legacy cruft. In fact, they don't even let you log in as
        there is <strong>no ssh on board</strong>. All that is left, is the most efficient structure to run your application on
        VirtualBox and in the cloud.
    </p>

    <p>So how do traditional instances compare to modern cloud native instances?</p>

    <table class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>Traditional Instances</th>
            <th>Cloud Native Instances</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Long lived</td>
            <td>Disposable</td>
        </tr>
        <tr>
            <td>Reconfigured on change</td>
            <td>Regenerated on change</td>
        </tr>
        <tr>
            <td>Persistent storage</td>
            <td>Ephemeral storage</td>
        </tr>
        <tr>
            <td>Multiple GBs</td>
            <td>Few MBs</td>
        </tr>
        <tr>
            <td>Ability to log in via SSH</td>
            <td>No SSH</td>
        </tr>
        </tbody>
    </table>

    <p>Quite a different world indeed.</p>

    <p>As you can see traditional file-based log rotation is not only outdated and risky (what if the instance's disk dies?),
    but also simply doesn't make sense anymore without the ability to log in.</p>

    <p>However logging as such is still a very important tool. It is invaluable for system behavior and error root cause analysis.
    So how can it be done in this new cloud native world?</p>

    <h2 class="blog-post-section">Logging needs</h2>

    <p>Here at Boxfuse we view logs as great forensic tool in case of trouble. We do not see logging as a general purpose data sink. If you
    need structured access to large amounts of data in your logs, you should probably consider other data stores instead.</p>

    <p>So what are the needs a logging solution must fulfill?</p>

    <ul>
        <li>It must be <strong>durable</strong> for a certain duration (log value decreases exponentially with time)</li>
        <li>It must be <strong>searchable</strong> (to quickly find related needless in the haystack)</li>
        <li>It must be <strong>centralized</strong> (all instances of an application send their logs to the same place)</li>
        <li>It must be <strong>integrated</strong> with the application (no mandatory clunky detours via disk or syslog)</li>
        <li>It must be <strong>fast</strong> with little overhead (no substantial performance degradation)</li>
    </ul>

    <p>Additionally we also want to be able to capture early system logs in case our application fails to start or can't
    connect to the centralized logging facility.</p>

    <p>We therefore want to <strong>distinguish between instance boot logs</strong> (low volume, instance-specific, for diagnosing startup issues)
    <strong>and application logs</strong> (high volume, application-level, for diagnosing application behavior issues).</p>

    <div class="blog-post-image">
        <img src="/assets/posts/logging-cloudnative/logs.png" alt="Logs">
    </div>

    <h2 class="blog-post-section">Instance Boot logs</h2>

    <p>The instance boot logs collect information from the earliest stages of instance startup (kernel boot) all the way
    to the point where the application is fully up and running. They are great for identifying environment-specific
        network and application configuration issues.</p>

    <p>Luckily all virtualization and cloud platforms make this information available and if you are using Boxfuse you have a
        <a href="/docs/commands/logs">unified and convenient way to access it</a>. All you
    need to do is</p>

    <pre class="console">&gt; boxfuse logs <em>instance-id</em></pre>

    <p>and you immediately see the boot log for that instance including DHCP lease acquiry and application startup details.</p>

    <h2 class="blog-post-section">Application logs</h2>

    <p>On the application side of things there are number of excellent logging solutions available that fulfill all criteria
    described above. For JVM-based applications <strong><a href="https://www.loggly.com/">Loggly</a></strong>,
        <strong><a href="https://logentries.com/">Logentries</a></strong> and
        <strong><a href="https://papertrailapp.com/">Papertrail</a></strong> make it a breeze as they all support direct
        <strong>Logback</strong> and <strong>Log4J</strong> integration.
    </p>

    <p>Messages are sent directly by a log appender from memory via HTTPS to their backend connectors where they are ingested, aggregated,
    indexed and made available via nice web-based dashboards.</p>

    <p>Let's look at one example in detail.</p>

    <h2 class="blog-post-section">Integrating Logback with Loggly</h2>

    <p>Let's look at how simple it is to integrate two popular solutions: Logback (successor to Log4J) and Loggly
        (we could have just as easily picked Logentries or Papertrail).</p>

    <p>Start by <a href="https://www.loggly.com/">creating a free Loggly account</a> and add a Java Logback source:</p>

    <div class="blog-post-image">
        <img src="/assets/posts/logging-cloudnative/source.png" alt="Add Loggly source">
    </div>

    <p>Now all you need to do is add the Loggly appender dependency to your build (it is available on Maven Central):</p>

    <pre class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;org.logback-extensions&lt;/groupId&gt;
    &lt;artifactId&gt;logback-ext-loggly&lt;/artifactId&gt;
    &lt;version&gt;0.1.2&lt;/version&gt;
&lt;/dependency&gt;</pre>

    <p>and configure the appender in your <code>logback.xml</code> (don't forget to make it async to avoid a performance hit):</p>

    <pre class="prettyprint">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;
    &lt;appender name="loggly" class="ch.qos.logback.ext.loggly.LogglyAppender"&gt;
        &lt;endpointUrl&gt;http://logs-01.loggly.com/inputs/<em>your-loggly-input-id</em>&lt;/endpointUrl&gt;
        &lt;pattern&gt;%d{ISO8601} %p %t %c{0}.%M - %m%n&lt;/pattern&gt;
    &lt;/appender&gt;
    &lt;appender name="loggly-async" class="ch.qos.logback.classic.AsyncAppender"&gt;
        &lt;appender-ref ref="loggly" /&gt;
    &lt;/appender&gt;
    &lt;root level="info"&gt;
        &lt;appender-ref ref="loggly-async" /&gt;
    &lt;/root&gt;
&lt;/configuration&gt;</pre>

    <p>That's it! Almost immediately you will see the logs appearing in the Loggly UI:</p>

    <div class="blog-post-image">
        <img src="/assets/posts/logging-cloudnative/loggly.png" alt="Loggly UI">
    </div>

    <p>You can now start search them, generate graphs and alerts, create custom dashboards and more!</p>

    <h2 class="blog-post-section">Summary</h2>

    <p>Logging for cloud native applications is a breeze. Simply combine Boxfuse for instance boot logs with modern
    hosted solutions like <strong><a href="https://www.loggly.com/">Loggly</a></strong>,
        <strong><a href="https://logentries.com/">Logentries</a></strong> or
        <strong><a href="https://papertrailapp.com/">Papertrail</a></strong> and their <strong>Logback or Log4J integrations</strong>
        for your application logs and you will have a comprehensive, robust and highly available solutions up and running in no time.</p>

    <p>Tired of snowflake servers? <strong><a href="https://console.boxfuse.com">Create your Boxfuse account now</a></strong>,
        start generating minimal and secure images in seconds and run them identically on VirtualBox and EC2.</p>
</div>
